<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Random in Ethereum</title><meta name="description" content="Randomness is notoriously difficult to obtain in Ethereum, a fact that was noted quickly since gambling was about the second thing anyone…"><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">Random in Ethereum</h1>
</header>
<section data-field="subtitle" class="p-summary">
Randomness is notoriously difficult to obtain in Ethereum, a fact that was noted quickly since gambling was about the second thing anyone…
</section>
<section data-field="body" class="e-content">
<section name="5a4a" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="fb3d" id="fb3d" class="graf graf--h3 graf--leading graf--title">Random in Ethereum</h3><p name="baf4" id="baf4" class="graf graf--p graf-after--h3">Randomness is notoriously difficult to obtain in Ethereum, a fact that was noted quickly since gambling was about the second thing anyone wanted to build. After world changing applications for new societies of course.</p><p name="a205" id="a205" class="graf graf--p graf-after--p">The problem lies in the fact that all miners have to obtain the same result to be able to determine its validity and commit it to the chain. Ethereum is a blockchain + a <em class="markup--em markup--p-em">deterministic </em>Turing machine, meaning there is no randomness involved. If there was a random opcode in place, all miners would obtain different results and the network would be unable to reach a consensus.</p><p name="c9de" id="c9de" class="graf graf--p graf-after--p">Naturally however, we have some workarounds. Each has their upsides and down, and their quirks and features.</p><h3 name="ac08" id="ac08" class="graf graf--h3 graf-after--p">The blockhash</h3><p name="08ad" id="08ad" class="graf graf--p graf-after--h3">The first source that springs to mind is blockhashes. They are essentially unpredictable and completely contained on chain, which makes them very easily accessible. One can then use that blockhash as a seed for random functions. This is a<a href="https://gist.github.com/alexvandesande/259b4ffb581493ec0a1c" data-href="https://gist.github.com/alexvandesande/259b4ffb581493ec0a1c" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank"> simple generator</a> written by Alex van de Sande; we use a similar function in <a href="https://github.com/otlw/otlw-assess" data-href="https://github.com/otlw/otlw-assess" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">otlw-assess</a>.</p><pre name="95c5" id="95c5" class="graf graf--pre graf-after--p">contract random {<br>    /* Generates a random number from 0 to 100 based on the last block hash */<br>    function randomGen(uint seed) constant returns (uint randomNumber) {<br>        return(uint(sha3(block.blockhash(block.number-1), seed ))%100);<br>    }<br><br>    /* generates a number from 0 to 2^n based on the last n blocks */<br>    function multiBlockRandomGen(uint seed, uint size) constant returns (uint randomNumber) {<br>        uint n = 0;<br>        for (uint i = 0; i &lt; size; i++){<br>            if (uint(sha3(block.blockhash(block.number-i-1), seed ))%2==0)<br>                n += 2**i;<br>        }<br>        return n;<br>    }<br>}</pre><p name="c297" id="c297" class="graf graf--p graf-after--pre">However, this is not entirely secure. The problem lies in the fact that miners have limited control over blockhashes, as they can choose whether or not to publish a block. By withholding a miner could exert their influence over the random function, and because of Ethereum’s deterministic nature, a miner can be very knowledgeable on the outcome if they do publish a mined block.</p><p name="cd49" id="cd49" class="graf graf--p graf-after--p">As such, to be economically viable. the reward at stake in any random dependent function must not exceed the mining reward. In situations where that criteria is met, block hashes can work very well, cleanly and simply.</p><h3 name="29b1" id="29b1" class="graf graf--h3 graf-after--p">Oracles</h3><p name="e044" id="e044" class="graf graf--p graf-after--h3">For times when things aren’t so clear cut we have “messy” solution: <strong class="markup--strong markup--p-strong">Oracles</strong></p><p name="ae04" id="ae04" class="graf graf--p graf-after--p">These services essentially provide a link to webservices outside the Ethereum network. So one could use it to access sources of random data through services like WolframAlpha, or random.org.</p><figure name="0325" id="0325" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 466px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 66.5%;"></div><img class="graf-image" data-image-id="1*OaIrJGcK6z9mr_1CG5VWJA.png" data-width="1000" data-height="665" src="https://cdn-images-1.medium.com/max/800/1*OaIrJGcK6z9mr_1CG5VWJA.png"></div><figcaption class="imageCaption">A flow chart describing how <a href="http://www.oraclize.it/" data-href="http://www.oraclize.it/" class="markup--anchor markup--figure-anchor" rel="noopener" target="_blank">oracalize.it</a> functions.</figcaption></figure><p name="84c7" id="84c7" class="graf graf--p graf-after--figure">There are obviously several points of failure. You have to have confidence in the Oracle you are using, and in both the validity and security of any random sources. Beyond this trust, however, there are difficulties.</p><p name="3b08" id="3b08" class="graf graf--p graf-after--p">Because of the nature of oracles they cannot directly return any requested value; they have to use <strong class="markup--strong markup--p-strong">callbacks</strong>. You first must call the random function, wait for it to communicate with the servers, then, a block or more later, it will trigger another function, passing the given value.</p><pre name="fd02" id="fd02" class="graf graf--pre graf-after--p">/*<br>   Simple &quot;roll a Dice&quot;.<br><br>   After calling the &quot;bet&quot; method along with 1 wei,<br>   the contract asks Wolfram Alpha to roll a dice.<br>   You get back either 0 wei or 2.<br>*/<br><br>import &quot;dev.oraclize.it/api.sol&quot;;<br><br>contract SimpleDice is usingOraclize {<br>    address owner;<br>    mapping (bytes32 =&gt; address) bets;<br><br>    function Lottery(){<br>        owner = msg.sender;<br>    }<br><br>    <strong class="markup--strong markup--pre-strong">function __callback(bytes32 myid, string result) {<br>        if (msg.sender != oraclize_cbAddress()) throw;<br>        if (uint(bytes(result)[0]) - 48 &gt; 3) bets[myid].send(2);<br>    }<br>    </strong><br>    function bet(){<br>        if ((msg.value != 1)||(this.balance &lt; 2)) throw;<br>        rollDice();<br>    }<br>    <br>    function rollDice() {<br>        bytes32 myid = oraclize_query(0, &quot;WolframAlpha&quot;, &quot;random number between 1 and 6&quot;);<br>        bets[myid] = msg.sender;<br>    }<br>    <br>    function kill(){<br>        if (msg.sender == owner) suicide(msg.sender);<br>    }<br>}</pre><p name="7317" id="7317" class="graf graf--p graf-after--pre">This is an <a href="https://github.com/oraclize/ethereum-examples/blob/master/solidity/SimpleDice.sol" data-href="https://github.com/oraclize/ethereum-examples/blob/master/solidity/SimpleDice.sol" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">example</a> contract from Oracalize implementing a simple dice function. Here the callback is fairly simple, depending on the result of the call it either sends 2 ether or not. However, in larger contracts callbacks can get more complex and impose a structural and gas-cost burden on your DApp. This can be worsened by the need to depend on TLSNotary proofs, which maintain the security of your calls. Overall however, if implemented properly, this can be more dependable and far less prone to malleability than blockhashes.</p><h3 name="b71d" id="b71d" class="graf graf--h3 graf-after--p">The Grail</h3><p name="68fc" id="68fc" class="graf graf--p graf-after--h3">There is something approaching a holy grail of Randomization in Ethereum, something both secure and on chain. It also happens to be a very eth-y solution, embracing economic incentives and decentralization. It’s the <a href="https://github.com/randao/randao" data-href="https://github.com/randao/randao" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">RanDAO</a>. It’s a DAO (Decentralized Autonomous Organization, though everyone probably knows what that is by now) that facilitates the generation of random numbers in a fixed cycle. It consists of at least 3 stages, where valid SHA3 hashes are committed, revealed, and combined to create a single random number. Participants are rewarded to incentivize contribution. It’s a pretty neat, if complex solution, but it does have its downsides. Numbers have to be created in a fixed cycle rather than on demand, which could prove as structurally influential to a DApp as an oracle callback. More importantly however, it requires widespread use and adoption to become dependable.</p><p name="8a15" id="8a15" class="graf graf--p graf-after--p">This is where work still needs to be done. Right now, we’ve built a tentative solution using blockhashes (with some extra steps in place to make sure it can’t be abused) for our own project. But the ideal solution would be a network scale ranDAO, with improvements like those <a href="https://www.reddit.com/r/ethereum/comments/4mdkku/could_ethereum_do_this_better_tor_project_is/d3v6djb" data-href="https://www.reddit.com/r/ethereum/comments/4mdkku/could_ethereum_do_this_better_tor_project_is/d3v6djb" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">suggested </a>by Vitalik, adopted and run, perhaps, by miners. There has to be a community wide push for this. It’ll enable DApps far more valuable than simply another Casino Contract, and will help develop the infrastructure needed for the platform to fully mature and live up to its potential, bringing secure and powerful randomness to the rest of the world.</p><h3 name="6914" id="6914" class="graf graf--h3 graf-after--p">Random and the World</h3><p name="edef" id="edef" class="graf graf--p graf-after--h3">Whether we like it or not this kind of randomness plays a huge role in the function and progress of out society. Of course we might not like it, as it grates against our normal sensibilities of order and meaning. But it’s inescapable because, unlike the majority of human proceedings, randomness is provably fair. It, somewhat counter-intuitively, introduces control and focus.</p><p name="3602" id="3602" class="graf graf--p graf-after--p">Because of this, randomness crops up in areas where we try to approach the singular truth of a matter, such as scientific trials, or legal juries. Drawing randomly from a population allows us to isolate the relevant traits of that population from traits any single individual in it might posses. With a jury we are trying to isolate the population’s judgement of a certain situation. With a randomized trial in pharmaceuticals we are trying to isolate the relevant properties of a drug. Law and the Scientific Method, are two critical developments, essential to the foundation of our society, and it’s of the utmost importance that their integrity is maintained.</p><p name="3d63" id="3d63" class="graf graf--p graf-after--p">When that integrity is violated, major problems can arise. Unjust juries can lead to decades long failures in legal systems, fudged trials can result in billions of dollars of damages, and even things as simple as bad polling can transform political landscapes. If randomness is compromised it can lead to large scale failures undermining the entirety of the systems these events occur in. More often than not these failures are a result of oversight, or deliberate action, from a central party, violating the fairness of a system.</p><h4 name="75ea" id="75ea" class="graf graf--h4 graf-after--p">Where Ethereum Comes In</h4><p name="b726" id="b726" class="graf graf--p graf-after--h4 graf--trailing">Decentralization and provable fairness; both are essential parts of the appeal of Ethereum. It’s a system that one can always trust to function exactly as expected to, and as such, is a perfect match for the societal applications of randomness. Systems for juries, for scientific research, for polling, based on Ethereum, would be incredibly powerful indeed.</p></div></div></section>
</section>
<footer><p class="p-tags">Tagged in <a href="https://medium.com/tag/blockchain" class="p-tag">Blockchain</a>, <a href="https://medium.com/tag/ethereum" class="p-tag">Ethereum</a>, <a href="https://medium.com/tag/random" class="p-tag">Random</a></p><p>By <a href="https://medium.com/@jrdprr" class="p-author h-card">Jared Pereira</a> on <a href="https://medium.com/p/50eefd09d33e"><time class="dt-published" datetime="2016-06-29T15:09:26.010Z">June 29, 2016</time></a>.</p><p><a href="https://medium.com/@jrdprr/random-in-ethereum-50eefd09d33e" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on November 12, 2017.</p></footer></article>

</body></html>